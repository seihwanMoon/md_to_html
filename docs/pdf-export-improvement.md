# PDF 내보내기 정교화 방안

DOCX 변환에 한계가 있으므로, **PDF를 최대한 정교하게 내보내는 것**을 우선하는 전략을 제안합니다.  
현재 앱은 이미 HWP 스타일 HTML을 생성하고, 인쇄 대화상자를 통해 PDF로 저장하는 구조이므로, 이 경로를 강화하는 것이 가장 자연스럽습니다.

---

## "원하는 곳에서 페이지 나누기" → 트랙 A가 적합

**질문**: 마크다운으로 책을 만들 때 원하는 곳에서 페이지를 나누고, PDF 출력 시 정확히 반영되게 하려면 A/B 중 어느 쪽이 맞나?

**답**: **트랙 A(현재 인쇄 경로)** 가 적합합니다.

- **트랙 A**: 브라우저 인쇄 엔진이 CSS `page-break-before: always` 를 **정확히** 따릅니다. 마크다운에 "여기서 페이지 나눔" 표시를 넣고, 내보내기 HTML에서 해당 위치에 `page-break-before: always` 를 넣으면, PDF로 저장할 때 그 위치에서 반드시 새 페이지가 시작됩니다.
- **트랙 B**: html2pdf.js 등은 캔버스 기반이라 페이지를 "높이로 잘라서" 만듭니다. "이 요소 바로 앞에서 나눠라" 식 옵션은 있지만, 레이아웃·폰트에 따라 위치가 미세하게 어긋날 수 있어, **정확한 위치 지정**에는 트랙 A보다 불리합니다.

**구현**: 트랙 A 기준으로 **페이지 나눔 문법**을 넣었습니다. 아래 "페이지 나눔 문법" 참고.

---

## 페이지 나눔 문법 (트랙 A, PDF에 정확히 반영)

마크다운 **원문**에서 아래 중 하나를 **한 줄로만** 넣으면, 그 위치에서 **새 페이지**가 시작됩니다. PDF(인쇄 → PDF로 저장)에서 그대로 반영됩니다.

| 문법 | 설명 |
|------|------|
| `\newpage` | LaTeX 스타일. 해당 줄만 있으면 그 위치에서 페이지 나눔. |
| `[pagebreak]` | 대괄호 문법. 위와 동일. |
| `<!-- pagebreak -->` | HTML 주석. 위와 동일. |
| `<!-- newpage -->` | HTML 주석. 위와 동일. |

- **미리보기**: 해당 위치에 점선이 보여 "여기서 페이지가 나뉜다"는 것을 확인할 수 있습니다.
- **내보내기/인쇄**: `page-break-before: always` 로 출력되므로, 인쇄 대화상자에서 "PDF로 저장" 시 해당 위치에서 새 페이지가 시작됩니다.

---

## 1. 현재 방식 정리

| 항목 | 내용 |
|------|------|
| **흐름** | `buildDocumentHtml(forExport: true)` → Blob HTML → iframe 로드 → `iframe.contentWindow.print()` |
| **사용자 동작** | 인쇄 대화상자에서 "대상: PDF로 저장" 선택 후 저장 |
| **장점** | 브라우저 인쇄 엔진 사용, 별도 라이브러리 없음, 미리보기와 동일한 HTML/CSS |
| **한계** | (1) 한 번에 "PDF 파일 다운로드" 불가 (2) 브라우저/OS마다 인쇄 품질 차이 (3) `position: running()` 헤더/푸터는 브라우저에서 제한적 지원 |

---

## 2. 방향: 두 가지 트랙

### 트랙 A: 현재 방식(HTML → 인쇄) 품질 극대화

**목표**: 동일한 HTML/인쇄 경로를 유지하면서, PDF로 저장했을 때 품질을 최대한 끌어올린다.

- **폰트 임베드**
  - 내보내기 HTML에 한글 폰트를 **인라인 또는 링크**로 포함해, PDF 저장 시 폰트가 빠지지 않도록 한다.
  - 이미 Google Fonts 링크는 있음; 필요 시 `@font-face` + base64 서브셋으로 임베드(용량·로딩 트레이드오프 검토).
- **@page / @media print 정리**
  - `@page { size: A4; margin: ... }` 유지, `-webkit-print-color-adjust: exact` 등 이미 적용된 부분 점검.
  - 페이지 나누기(`page-break-before/after/inside`), 고아/과부(`orphans`, `widows`) 일관 적용.
- **인쇄용 UI 가이드**
  - "PDF" 버튼 툴팁 또는 도움말에  
    「인쇄 대화상자에서 **대상: PDF로 저장**을 선택하면 HWP 스타일 PDF를 얻을 수 있습니다」  
    문구 추가 → 사용자 혼동 감소.
- **헤더/푸터**
  - `position: running(hwpHeader)` 등은 브라우저 인쇄에서 지원이 제한적일 수 있음.
  - 유지하되, "모든 페이지에 헤더/푸터가 나오지 않을 수 있음"을 문서에 명시.
  - (선택) 나중에 서버 측 PDF 생성 도입 시 Prince/PDFreactor 등에서 running 요소 활용 검토.

**기대 효과**: 추가 의존성 없이, 현재 구조만으로 PDF 품질·일관성 개선.

---

### 트랙 B: 클라이언트에서 PDF 파일 직접 생성(다운로드)

**목표**: "PDF" 버튼 한 번에 **파일로 다운로드**되게 하는 옵션을 제공한다.

- **라이브러리 후보**
  - **html2pdf.js** (html2canvas + jsPDF): HTML 요소를 캔버스로 그린 뒤 PDF로 합성. 브라우저 전용, NPM/CDN 지원.
  - **jspdf + html2canvas** 직접 조합: 동일한 방식, 세부 제어 가능.
- **동작**
  - 내보내기용 HTML을 임시 컨테이너에 넣고, 해당 요소를 html2pdf로 변환 → Blob → `download="document.pdf"` 로 저장.
  - 기존 "인쇄" 버튼은 유지하고, "PDF 다운로드"를 별도 버튼 또는 같은 버튼의 옵션(예: 드롭다운)으로 제공.
- **품질**
  - 캔버스 기반이라 **폰트/레이아웃이 인쇄 대화상자와 다를 수 있음**. 한글·줄바꿈·페이지 나누기 등은 테스트 필요.
  - 용량·해상도 옵션(이미지 품질, 스케일) 조정으로 품질/파일 크기 타협 가능.

**기대 효과**: 별도 클릭 없이 PDF 파일을 바로 받을 수 있어 UX 개선. 품질은 트랙 A(인쇄)보다 낮을 수 있으므로 "고품질은 인쇄 → PDF로 저장 권장" 문구를 둘 수 있음.

---

## 3. 권장 진행 순서

1. **트랙 A 먼저**  
   - 폰트·@page·페이지 나누기·고아/과부 점검 및 정리.  
   - "PDF로 저장" 안내 문구 추가.  
   → 변경 범위 작고, 현재 사용자(인쇄 → PDF 저장)에게 바로 이득.

2. **트랙 B는 선택**  
   - "한 번에 PDF 다운로드" 수요가 있으면 html2pdf.js(또는 jspdf+html2canvas) 도입.  
   - 품질 비교(인쇄 PDF vs 다운로드 PDF) 후, 필요 시 옵션(해상도, 여백) 노출.

3. **장기**  
   - 서버를 둘 경우 Puppeteer/Playwright 등으로 동일 HTML을 렌더링해 PDF 생성하면, 트랙 A와 동일한 품질로 "다운로드"까지 제공 가능.

---

## 4. DOCX와의 역할 나누기

- **PDF**: HWP 스타일·인쇄 품질·표지/목차/헤더·푸터·폰트 등 **최종 출력물**을 최대한 정교하게 → 트랙 A/B로 강화.
- **DOCX**: 편집·공유용으로 "대략 비슷한 구조" 제공. 수식/다이어그램/각주 등은 한계를 인정하고, 필요 시 "고품질 출력은 PDF 사용" 안내.

이렇게 하면 DOCX 한계를 보완하면서, **PDF를 메인 출력 채널**로 키울 수 있습니다.

---

## 5. 다음 단계(체크리스트)

- [ ] 트랙 A: 내보내기 HTML에 폰트 포함 방식 점검(링크 vs 임베드)
- [ ] 트랙 A: @media print 내 페이지 나누기·고아/과부 재검토
- [ ] 트랙 A: 툴팁/도움말에 "PDF로 저장" 안내 추가
- [ ] (선택) 트랙 B: html2pdf.js 도입 및 "PDF 다운로드" 버튼 추가
- [ ] (선택) 트랙 B: 인쇄 PDF vs 다운로드 PDF 품질 비교 및 옵션 설계

---

*작성: 2026-02-06. DOCX 한계 보완을 위한 PDF 정교화 제안.*
